<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† - Ù…Ù†ØµØ© Ø§Ù„ØªØ§Ø¬Ø± Ø§Ù„Ø°ÙƒÙŠØ©</title>

  <style>
    :root{
      --brand:#0f4c81;
      --brand-dark:#0b3a63;
      --bg:#f5f7fa;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --ok:#16a34a;
      --bad:#b42318;
      --shadow:0 10px 24px rgba(0,0,0,.08);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,system-ui,-apple-system,Segoe UI; background:var(--bg); color:var(--text)}
    header{background:var(--brand); color:#fff; padding:22px 16px; text-align:center}
    header h1{margin:0}
    header p{margin:6px 0 0;opacity:.95}

    nav{background:var(--brand-dark); display:flex; gap:10px; justify-content:center; padding:10px 12px; flex-wrap:wrap}
    nav a{color:#fff;text-decoration:none;padding:8px 12px;border-radius:8px;opacity:.95}
    nav a:hover{background:rgba(255,255,255,.12)}

    main{max-width:980px; margin:18px auto; padding:0 14px}
    .card{background:var(--card); border-radius:14px; padding:18px; box-shadow:var(--shadow); border:1px solid rgba(229,231,235,.7)}
    h2{margin:0 0 8px}
    .muted{color:var(--muted); margin:0 0 12px; line-height:1.7}

    .row{display:grid; gap:12px; grid-template-columns:1fr}
    @media(min-width:820px){ .row{grid-template-columns:1fr 1fr} }

    label{display:block;margin:10px 0 6px;font-weight:700}
    input,select{
      width:100%;padding:12px;border-radius:10px;border:1px solid #d1d5db;
      font-size:16px;background:#fff; outline:none;
    }
    input:focus,select:focus{border-color:rgba(15,76,129,.55); box-shadow:0 0 0 4px rgba(15,76,129,.10)}

    .btn{
      margin-top:14px;background:var(--brand);color:#fff;border:none;width:100%;
      padding:12px 16px;border-radius:10px;font-weight:800;font-size:16px;cursor:pointer;
    }
    .btn:disabled{opacity:.65;cursor:not-allowed}

    .trust{
      margin-top:14px; padding-top:12px; border-top:1px dashed var(--line);
      font-size:13px; color:var(--muted); line-height:1.7;
      display:grid; gap:6px;
    }
    .trust a{color:var(--brand); text-decoration:none; font-weight:700}
    .trust a:hover{text-decoration:underline}

    .msg{
      display:none; margin-top:12px; padding:12px; border-radius:10px; font-weight:700;
      border:1px solid var(--line);
      white-space:pre-wrap;
      word-break:break-word;
    }
    .msg.ok{display:block; background:#eaf7ef; color:var(--ok); border-color:rgba(22,163,74,.25)}
    .msg.bad{display:block; background:#fdecec; color:var(--bad); border-color:rgba(180,35,24,.25)}

    footer{margin-top:18px; text-align:center; padding:14px; color:var(--muted)}
  </style>
</head>

<body>

<header>
  <h1>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</h1>
  <p>Ø§Ù…Ù„Ø£ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø³ÙŠØ·Ø© â€” ÙˆØ³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨Ùƒ ÙÙˆØ±Ù‹Ø§ Ø¨Ø´ÙƒÙ„ Ø¢Ù„ÙŠ</p>
</header>

<nav>
  <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  <a href="pricing.html">Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</a>
  <a href="signup.html">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</a>
  <a href="contact.html">ØªÙˆØ§ØµÙ„</a>
</nav>

<main>
  <section class="card">
    <h2>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø·</h2>
    <p class="muted">
      Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…. Ù„Ù† Ù†Ø·Ù„Ø¨ Ù…Ù†Ùƒ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†ÙƒÙŠØ© Ù‡Ù†Ø§.
    </p>

    <!-- âœ… Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù… onsubmit="return false" -->
    <form id="signupForm">
      <div class="row">
        <div>
          <label for="biz">Ø§Ø³Ù… Ø§Ù„Ù†Ø´Ø§Ø·</label>
          <input id="biz" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ø§Ù„Ù… Ø§Ù„ÙØ®Ø§Ù…Ø© Ù„Ù„Ø¯ÙŠÙƒÙˆØ±" autocomplete="organization" required />
        </div>

        <div>
          <label for="type">Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø·</label>
          <select id="type">
            <option value="Ø£Ø«Ø§Ø«">Ø£Ø«Ø§Ø«</option>
            <option value="Ù…Ø·Ø¹Ù… / ÙƒÙˆÙÙŠ">Ù…Ø·Ø¹Ù… / ÙƒÙˆÙÙŠ</option>
            <option value="Ù…ØºØ³Ù„Ø© / ØµØ§Ù„ÙˆÙ†">Ù…ØºØ³Ù„Ø© / ØµØ§Ù„ÙˆÙ†</option>
            <option value="Ø³ÙˆØ¨Ø±Ù…Ø§Ø±ÙƒØª">Ø³ÙˆØ¨Ø±Ù…Ø§Ø±ÙƒØª</option>
            <option value="Ø¹Ù‚Ø§Ø±Ø§Øª">Ø¹Ù‚Ø§Ø±Ø§Øª</option>
            <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
          </select>
        </div>

        <div>
          <label for="city">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label>
          <input id="city" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø±ÙŠØ§Ø¶ / Ø¬Ø¯Ø©" autocomplete="address-level2" />
        </div>

        <div>
          <label for="email">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
          <input id="email" type="email" placeholder="example@email.com" autocomplete="email" required />
        </div>

        <div>
          <label for="whatsapp">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨</label>
          <input id="whatsapp" inputmode="tel" placeholder="Ù…Ø«Ø§Ù„: 0500000000" autocomplete="tel" required />
          <div class="muted" style="font-size:12px;margin-top:6px">ÙŠÙØ¶Ù„ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù‚Ù… Ø¨Ø¯ÙˆÙ† Ø±Ù…ÙˆØ² Ø£Ùˆ Ù…Ø³Ø§ÙØ§Øª.</div>
        </div>
      </div>

      <!-- âœ… submit Ø¨Ø¯Ù„ onclick -->
      <button id="submitBtn" type="submit" class="btn">
        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·
      </button>

      <div id="statusMsg" class="msg"></div>

      <div class="trust">
        <div>ğŸ”’ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ØªÙØ³ØªØ®Ø¯Ù… ÙÙ‚Ø· Ù„ØºØ±Ø¶ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØªÙ†ÙÙŠØ° Ø§Ù„Ø®Ø¯Ù…Ø©.</div>
        <div>âœ… Ù„Ø§ ÙŠØªÙ… ØªØ®Ø²ÙŠÙ† Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†ÙƒÙŠØ© Ø¯Ø§Ø®Ù„ Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬.</div>
        <div>ğŸ“„ Ø¨Ø¥Ø±Ø³Ø§Ù„Ùƒ Ø§Ù„Ø·Ù„Ø¨ ÙØ£Ù†Øª ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ <a href="privacy.html">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>.</div>
      </div>
    </form>
  </section>
</main>

<footer>Â© 2026 Ù…Ù†ØµØ© Ø§Ù„ØªØ§Ø¬Ø± Ø§Ù„Ø°ÙƒÙŠØ©</footer>

<script>
  /**
   * âœ… Ù…Ù‡Ù…:
   * - Ø§Ø³ØªØ®Ø¯Ù… Publishable/Anon ÙÙ‚Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­
   * - Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Service Role Ø¯Ø§Ø®Ù„ HTML Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§
   */

  // 1) Project URL
  const SUPABASE_URL = "https://udsqvnvjktggdtzpoyts.supabase.co";

  // 2) Ø¶Ø¹ Ø§Ù„Ù…ÙØªØ§Ø­ Ù‡Ù†Ø§ (Publishable/Anon) ÙƒØ§Ù…Ù„ ÙˆÙÙŠ Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·
  // Ù…Ø«Ø§Ù„ ØµØ­ÙŠØ­: sb_publishable_... Ø£Ùˆ eyJhbGci... (ÙƒØ§Ù…Ù„)
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVkc3F2bnZqa3RnZ2R0enBveXRzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4NjMyMDEsImV4cCI6MjA4NTQzOTIwMX0.le_aDD0cB7PCg_d6bH_rvGfGagqriEN1oinXV5N-frM";

  // 3) Edge Function endpoint
  const EDGE_FUNCTION_URL = `${SUPABASE_URL}/functions/v1/smooth-action`;

  const form = document.getElementById("signupForm");
  const msgEl = document.getElementById("statusMsg");
  const btn = document.getElementById("submitBtn");

  // Ø£ÙŠ Ø®Ø·Ø£ JS Ø³ÙŠØ¸Ù‡Ø± Ù„Ùƒ Ø±Ø³Ø§Ù„Ø© Ø¨Ø¯Ù„ Ø§Ù„ØµÙ…Øª
  window.addEventListener("error", (e) => {
    showMsg("bad", "âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØµÙØ­Ø©: " + (e?.message || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"));
  });

  function showMsg(type, text){
    msgEl.className = "msg " + (type === "ok" ? "ok" : "bad");
    msgEl.textContent = text;
    msgEl.style.display = "block";
  }

  function normalizePhone(value){
    return (value || "")
      .replace(/\s+/g, "")
      .replace(/[()\-\+]/g, "");
  }

  function setLoading(loading){
    btn.disabled = loading;
    btn.textContent = loading ? "Ø¬Ø§Ø±Ù ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·..." : "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø´Ø§Ø·";
  }

  function isKeyLooksWrong(key){
    if (!key) return true;
    if (key.includes("PASTE_YOUR")) return true;
    // Ù„Ùˆ ÙƒØ§Ù† ÙÙ‚Ø· Ø¨Ø¯Ø§ÙŠØ© JWT Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ù‹Ø§ ØºØ§Ù„Ø¨Ù‹Ø§ Ù†Ø§Ù‚Øµ
    if (key.startsWith("eyJ") && key.length < 200) return true;
    // Ù„Ùˆ ÙƒØ§Ù† ÙÙŠÙ‡ Ø£Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯Ø© ÙŠÙƒØ³Ø± Ø£Ùˆ ÙŠØ³Ø¨Ø¨ Ù…Ø´Ø§ÙƒÙ„
    if (key.includes("\n")) return true;
    return false;
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    setLoading(true);
    showMsg("ok", "â³ Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ø±Ø³Ø§Ù„..."); // Ø±Ø³Ø§Ù„Ø© ÙÙˆØ±ÙŠØ©

    const business_name = document.getElementById("biz").value.trim();
    const business_type = document.getElementById("type").value.trim();
    const city = document.getElementById("city").value.trim();
    const email = document.getElementById("email").value.trim();
    const whatsapp = normalizePhone(document.getElementById("whatsapp").value.trim());

    if (!business_name || !email || !whatsapp){
      showMsg("bad", "ÙØ¶Ù„Ø§Ù‹ Ø£Ø¯Ø®Ù„: Ø§Ø³Ù… Ø§Ù„Ù†Ø´Ø§Ø· + Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ + Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨.");
      setLoading(false);
      return;
    }

    if (isKeyLooksWrong(SUPABASE_ANON_KEY)){
      showMsg("bad",
        "âš ï¸ Ø§Ù„Ù…ÙØªØ§Ø­ ØºÙŠØ± ØµØ­ÙŠØ­/Ù†Ø§Ù‚Øµ.\n" +
        "Ù„Ø§Ø²Ù… ØªÙ„ØµÙ‚ Publishable/Anon key ÙƒØ§Ù…Ù„ ÙÙŠ Ø³Ø·Ø± ÙˆØ§Ø­Ø¯.\n" +
        "Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… sb_secret ÙˆÙ„Ø§ Service Role."
      );
      setLoading(false);
      return;
    }

    // Timeout 15 Ø«Ø§Ù†ÙŠØ©
    const controller = new AbortController();
    const timeoutId = setTimeout(() => controller.abort(), 15000);

    try{
      const res = await fetch(EDGE_FUNCTION_URL, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "apikey": SUPABASE_ANON_KEY,
          "Authorization": "Bearer " + SUPABASE_ANON_KEY
        },
        body: JSON.stringify({ business_name, business_type, city, email, whatsapp }),
        signal: controller.signal
      });

      const raw = await res.text();
      let data = {};
      try { data = JSON.parse(raw); } catch {}

      if (res.ok && (data.success === true || data.ok === true)){
        showMsg("ok", "âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ù†Ø´Ø§Ø·Ùƒ Ø¨Ù†Ø¬Ø§Ø­. ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ ÙˆØ³ÙŠØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¢Ù„ÙŠÙ‹Ø§.");
        form.reset();
      } else if (res.status === 401 || res.status === 403){
        showMsg("bad", "âŒ ØºÙŠØ± Ù…ØµØ±Ø­ (401/403).\nØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ³ØªØ®Ø¯Ù… Publishable/Anon ÙˆÙ„ÙŠØ³ Secret/Service Role.");
      } else if (res.status === 404){
        showMsg("bad", "âŒ Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙ†ÙƒØ´Ù† ØºÙŠØ± ØµØ­ÙŠØ­.\nØªØ£ÙƒØ¯ Ø£Ù† smooth-action Ù…Ù†Ø´ÙˆØ± ÙˆØ£Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­.");
      } else {
        const serverMsg = (data && (data.error || data.message)) ? (data.error || data.message) : "";
        showMsg("bad",
          `âŒ ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.\nØ§Ù„Ø­Ø§Ù„Ø©: ${res.status}\n` +
          (serverMsg ? `Ø§Ù„Ø³Ø¨Ø¨: ${serverMsg}` : `Ø§Ù„Ø±Ø¯: ${raw.slice(0,220)}`)
        );
      }
    } catch (err){
      if (err && err.name === "AbortError"){
        showMsg("bad", "â±ï¸ Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ (15 Ø«Ø§Ù†ÙŠØ©). ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
      } else {
        showMsg("bad", "âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: " + (err?.message || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"));
      }
    } finally {
      clearTimeout(timeoutId);
      setLoading(false);
    }
  });
</script>

</body>
</html>
